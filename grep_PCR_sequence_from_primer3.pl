#!/usr/bin/perl
use strict;
use warnings;

#MISA produced SSR primers which have start pos. and length of products

#ID	SSR nr.	SSR type	SSR	size	start	end	FORWARD PRIMER1 (5'-3')	Tm(癈)	size	REVERSE PRIMER1 (5'-3')	Tm(癈)	size	PRODUCT1 size (bp)	start (bp)	end (bp)
#20404914_length_5439_cvg_23.6_tip_0	1	p4	(TAGA)6	24	4333	4356	TATCTAAGGGGCAAACGTGC	60.096	20	CCACTGGTCTCCCTAACCAA	59.959	20	745	4110	4854
#20405206_length_5561_cvg_8.7_tip_1	2	c	(CTAT)8ctacacatgcatctatctatctattcatctatacatctatatctatacatcta(TATC)6	109	3925	4033	TTTCGTCCTGCACATGGATA	60.073	20	AGGAGGCGACAATTAGGGAT	59.925	20	585	3811	4395
#20405206_length_5561_cvg_8.7_tip_1	1	p4	(ATAG)8	32	2462	2493	ATCGTCTCCTGGATTGATGC	60.042	20	ATTGAGCAATTTCTGGGTGG	59.933	20	567	2093	2659
#20405222_length_5570_cvg_51.9_tip_1	1	p4	(AGAC)6	24	3016	3039	ATGACGAGTGGGCCATAGAG	60.096	20	CGGCCGTTTATATAGCCAGA	60.075	20	740	2585	3324
#20405264_length_5595_cvg_7.3_tip_1	1	p4	(GAAA)5	20	1616	1635	GATACATCCAGATCCCGTGG	60.158	20	TCCTATGGACTAGTTGGGCG	60.088	20	668	1287	1954
#20405306_length_5611_cvg_27.4_tip_0	1	p4	(GATA)5	20	2055	2074	AAAAAGTTTGGGAGGGCAGT	59.976	20	ATGTTTGCCCCCTCTCTTCT	60.074	20	670	1874	2543
#
#>17714518 length 200 cvg_4.8_tip_0
#AAAAAAAAAATGACATTCCAACAATAGCACAACTCATGTGGAGAAGCAAATACTAACCGATAATTGTTTAAGAAGAAAGGTGGGATGCCTACCGGGGCATCCCCAAGCTTAGGTGCTTGAGACTCCTTGAAATATTATCTTGGGGTGCCTTGGGCATCCCCAAGCTTGAGCTTTTGTGTCTCCTTAATGCCTCTCATATC
#>17714520 length 200 cvg_63.5_tip_0
#AAAAAAAAACAGAATCATGTACGAGTCTGTTTAAACAAACTAACAGATATTCCTGGTTTTTATTTCTAATGCTGGCACCGAAGCGTTCGAGGGATGTGCGCTAGCGTACATGTCCGATTTTTTTTTCATCGGTTTTTTCCTCGTAACTAGTCAATGTGTACGTGCAATGCACGTTAATTTGGAAGTATATTAAGTGCATG
#>17714522 length 200 cvg_63.0_tip_0
#AAAAAAAAACAGAATCTGTCAAAAACAGAACAGTCTGCGAAGATCCGAATTGTTCTAATACTTCCGTAACTCCAAAAATTCTTAAAAAATAGGACATCAGAGGAAATTCGTATATAAATCTTGTGTAAAATATTCAGAGTTTTTCCCTGCTCCAGTAAAAAATAAGAATTGTTTTCCTGAGTGCAAATGTTTCTGTTTTT
#>17714524 length 200 cvg_62.0_tip_0
#AAAAAAAAATTCATTTGCCTTTTTCTCGTTTGATCTTTTGTCTGCTTGCTTTTAGTTGTGACCATGAGTGATTTCGGTATACAGATGATGGTAGAACTCCTAAAATTGGATGTTCTGCTGATCTCGATGCTAAAACTTTTGTGATTGGACAAGGGAATATTATAGGAAAAGAAGCTATACAAGAGTTCTTTAATTGCATT
#>17714526 length 200 cvg_32.9_tip_0
#AAAAAAAAAGAATCCTCCCCATGACAGCTGGGACCCACCAGCTATATCTTCGCACGGAAGGAGGTGCCTCCTTATTAAGCAAAAAATAATGACTGCACCCCATGACAGCTCGGGCCCACCAGATTTTTGGAGGCTGACTTGTGGCCCTACTAAGTTGACGCGTACGCAGGGCTTTGTCAACTTAGTCAATAAATGATTCT
#

#target: grep the products sequence and blast to homologous genomes such as chines spring chr4A,B,D

$/ = ">";
open IN1, $ARGV[0] or die;
my %hash;
while(<IN1>){
	next if /^>$/;
	chomp;
	/(\d+).*\n([ATCG]*)/;
	#print "$1\n";
	#print "$2\n";
	my $chrname = $1;
	my $sequence = $2;
	$hash{$chrname} = $sequence;
}
close IN1;


$/ = "\n";
open IN, $ARGV[1] or die;
while(<IN>){
	next if /ID/;
	chomp;
	my @t = split /\t/;
	$t[0] =~ /(\d+)/;
	my $name = $1;
	my $start = $t[-2];
	my $size = $t[-3];
	#print "$1\n$t[-2]\n$t[-3]\n";
	if(exists $hash{$name}){
		my $products = substr($hash{$name},$start,$size);	#start with 0!!!!!!!!!!!!!
		print ">$t[0]\n$products\n";
	}
}
close IN;